<script>
// ================= AUDIO =================
const audio = document.getElementById("audio");
const playBtn = document.getElementById("play");
const volume = document.getElementById("volume");
let playing = false;
volume.oninput = ()=>audio.volume = volume.value;
playBtn.onclick = ()=>{
  if(!playing){ audio.volume = volume.value; audio.play(); playBtn.textContent="■"; playing=true; fullscreen(); }
  else { audio.pause(); playBtn.textContent="▶"; playing=false; }
};
function fullscreen(){ const el=document.documentElement; if(el.requestFullscreen) el.requestFullscreen().catch(()=>{}); }

// ================= LINKS =================
function openSocialLive(){ window.open("https://lavandaaudit.github.io/lavanda.soft/", "_blank"); }
function openCriptoLabLive(){ window.open("https://lavandaaudit.github.io/ibonarium.economy/", "_blank"); }
function openIbonariumTV(){ window.open("https://lavandaaudit.github.io/history.musem.ibonarium/", "_blank"); }
function openSolarStability(){ window.open("https://lavandaaudit.github.io/human.stability.calendar/", "_blank"); }
function openIModular01(){ window.open("https://lavandaaudit.github.io/synthesizer/", "_blank"); }
function openIModularXIII(){ window.open("https://lavandaaudit.github.io/modularxiii/", "_blank"); }
function openMagnetLab(){ window.open("https://lavandaaudit.github.io/Geospace-Activity/", "_blank"); }
function openIDrum32(){ window.open("https://lavandaaudit.github.io/ibonarium.drum.machine.32.v1.3/", "_blank"); }
function openEcoSystem(){ window.open("https://lavandaaudit.github.io/ibonarium.eco.system.radar/", "_blank"); }
function openOceanLab(){ window.open("https://lavandaaudit.github.io/ocean.ibonarium.live.lab/", "_blank"); }
function openHumanityLab(){ window.open("https://lavandaaudit.github.io/Ibonarium.HUMANITY.lab.live/", "_blank"); }
function openAgroLab(){ window.open("https://lavandaaudit.github.io/ibonarium.agro.ua/", "_blank"); }
function openPhGeoLab(){ window.open("https://lavandaaudit.github.io/test2/", "_blank"); }
const translatorLink=document.getElementById("translatorLink");
translatorLink.onclick=e=>{ e.preventDefault(); window.open("https://lavandaaudit.github.io/live.monitor.lab/", "_blank"); };

// ================= GEOMETRIC CHAOS CANVAS =================
const canvas = document.getElementById('c');
const ctx = canvas.getContext('2d');
const dataDiv = document.getElementById('data');
const clockDiv = document.getElementById('clock');
const statusDiv = document.getElementById('status');

function resizeCanvas(){ canvas.width = window.innerWidth; canvas.height = window.innerHeight; }
window.addEventListener('resize', resizeCanvas);
resizeCanvas();

const startTime = Date.now();
function formatRelativeTime(ms){
  const s=Math.floor(ms/1000);
  if(s<60) return `+${s}s`;
  const m=Math.floor(s/60), sec=s%60;
  if(m<60) return `+${m}m ${sec}s`;
  const h=Math.floor(m/60), min=m%60;
  return `+${h}h ${min}m`;
}
function updateClock(){
  const now=new Date();
  clockDiv.innerHTML = `${String(now.getHours()).padStart(2,'0')}:${String(now.getMinutes()).padStart(2,'0')}:${String(now.getSeconds()).padStart(2,'0')}<br>${formatRelativeTime(Date.now()-startTime)}`;
}
setInterval(updateClock,1000); updateClock();

// --- Зірки ---
const stars = Array.from({length:300},()=>({x:Math.random()*canvas.width,y:Math.random()*canvas.height,size:Math.random()*1.4+0.4,baseAlpha:Math.random()*0.4+0.25,twinkle:Math.random()*0.015+0.006}));

// --- Дані ---
let realData = { seismic:0.5, magnetic:0.5, atmosphere_wind:0.5, atmosphere_pressure:0.5, atmosphere_temp:0.5, ocean:0.5, solar_radiation:0.5, solar_wind:0.5, precipitation:0.5, chaos:0.5 };
let dataHistory = {}; Object.keys(realData).forEach(k=>dataHistory[k]=[]);
let sources = {};

// --- Генератор випадкових даних (імітація реальних сенсорів) ---
function simulateData(){
  realData.seismic = 0.4 + Math.sin(Date.now()*0.001)*0.3 + Math.random()*0.1;
  realData.magnetic = 0.5 + Math.sin(Date.now()*0.0008+5)*0.4 + Math.random()*0.05;
  realData.atmosphere_wind = 0.3 + Math.abs(Math.sin(Date.now()*0.0012+2))*0.6;
  realData.atmosphere_pressure = 0.5 + Math.sin(Date.now()*0.0007)*0.2;
  realData.atmosphere_temp = 0.4 + Math.sin(Date.now()*0.0009+1)*0.4;
  realData.ocean = 0.5 + Math.sin(Date.now()*0.0015)*0.35;
  realData.solar_radiation = 0.6 + Math.sin(Date.now()*0.001)*0.3;
  realData.solar_wind = 0.5 + Math.sin(Date.now()*0.0017+3)*0.3;
  realData.precipitation = 0.3 + Math.abs(Math.sin(Date.now()*0.0012+4))*0.6;
  realData.chaos = 0.4 + Math.random()*0.6;

  // Оновлення історії
  Object.keys(realData).forEach(k=>{
    dataHistory[k].push(realData[k]);
    if(dataHistory[k].length>100) dataHistory[k].shift();
  });

  // Оновлення HUD
  let html = '';
  Object.keys(realData).forEach(k=>{
    html += `${k}: ${realData[k].toFixed(2)}<br>`;
  });
  dataDiv.innerHTML = html;
}
setInterval(simulateData,200); // оновлення кожні 200мс

// --- БЛОБИ ---
const blobs = [
  { param:'seismic', color:'rgba(220,60,80,', phase:0.0, targetSize:6, targetAlpha:0.75 },
  { param:'magnetic', color:'rgba(60,180,255,', phase:1.2, targetSize:6, targetAlpha:0.75 },
  { param:'atmosphere_wind', color:'rgba(80,255,160,', phase:2.4, targetSize:6, targetAlpha:0.7 },
  { param:'atmosphere_temp', color:'rgba(255,180,60,', phase:3.6, targetSize:6, targetAlpha:0.7 },
  { param:'solar_radiation', color:'rgba(255,240,100,', phase:4.8, targetSize:5, targetAlpha:0.65 },
  { param:'solar_wind', color:'rgba(200,120,255,', phase:6.0, targetSize:6, targetAlpha:0.7 },
  { param:'precipitation', color:'rgba(100,220,255,', phase:7.2, targetSize:6, targetAlpha:0.7 }
];
blobs.forEach(b=>{ b.angle=Math.random()*Math.PI*2; b.radius=60+Math.random()*50; b.currentSize=b.targetSize; b.currentAlpha=b.targetAlpha; b.currentDist=b.radius; });
function lerp(a,b,t){ return a+(b-a)*t; }

// --- Фонові формули ---
const formulas=["E=mc^2","F=ma","∇·E=ρ/ε₀","∫F·dr=ΔK","a^2+b^2=c^2"];
const formulaObjs=formulas.map(f=>({text:f,x:Math.random()*window.innerWidth,y:Math.random()*window.innerHeight,alpha:0,phase:Math.random()*Math.PI*2}));

// --- Основний цикл ---
let t=0;
function loop(){
  t+=0.016;
  ctx.fillStyle='rgba(0,0,0,0.08)'; ctx.fillRect(0,0,canvas.width,canvas.height);

  // Зірки
  const starMod=1-realData.chaos*0.35;
  stars.forEach(s=>{
    const tw=Math.sin(t*s.twinkle*12+s.x*0.008)*0.18*starMod;
    ctx.fillStyle=`rgba(220,235,255,${Math.max(0.08,s.baseAlpha+tw).toFixed(3)})`;
    ctx.fillRect(s.x,s.y,s.size,s.size);
  });

  // Багатошарові полігони
  const shapes=8;
  const cx=canvas.width/2, cy=canvas.height/2;
  for(let i=0;i<shapes;i++){
    const angle=t*0.2+i*Math.PI*0.5;
    const r=120+60*Math.sin(t*0.3+i)+realData.seismic*30;
    const sides=3+i+Math.floor(realData.chaos*5);
    ctx.beginPath();
    for(let s=0;s<sides;s++){
      const a=(Math.PI*2/sides)*s+angle;
      const x=cx+Math.cos(a)*r*(0.8+0.4*Math.sin(t+i));
      const y=cy+Math.sin(a)*r*(0.8+0.4*Math.cos(t+i));
      s===0?ctx.moveTo(x,y):ctx.lineTo(x,y);
    }
    ctx.closePath();
    ctx.strokeStyle=`rgba(${50+i*30},${100+i*20},${200-i*20},${0.08+realData.chaos*0.2})`;
    ctx.lineWidth=1.2+realData.magnetic*2;
    ctx.stroke();
  }

  // Спіралі
  const spiralPoints=180;
  ctx.beginPath();
  for(let i=0;i<spiralPoints;i++){
    const angle=i*0.2+t*0.6;
    const radius=i*0.8+50*Math.sin(t*0.5+i*0.3)+realData.solar_radiation*20;
    const x=cx+Math.cos(angle)*radius;
    const y=cy+Math.sin(angle)*radius;
    i===0?ctx.moveTo(x,y):ctx.lineTo(x,y);
  }
  ctx.strokeStyle=`rgba(255,180,80,${0.05+realData.solar_wind*0.15})`; ctx.lineWidth=1.5; ctx.stroke();

  // Формули
  formulaObjs.forEach(f=>{
    f.alpha=Math.sin(t*0.5+f.phase)*0.5+0.5;
    ctx.fillStyle=`rgba(180,255,200,${f.alpha*0.25})`;
    ctx.font="18px Courier New";
    ctx.fillText(f.text,f.x,f.y);
  });

  requestAnimationFrame(loop);
}
loop();
</script>
